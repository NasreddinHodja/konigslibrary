#+TITLE: Konigslibrary
#+DESCRIPTION: Client-side manga reader — Svelte 5, Tauri, custom ZIP parser

#+html: <a href="https://svelte.dev"><img src="https://img.shields.io/badge/Svelte-5-FF3E00?logo=svelte&logoColor=white"></a>
#+html: <a href="https://svelte.dev/docs/kit"><img src="https://img.shields.io/badge/SvelteKit-2-FF3E00?logo=svelte&logoColor=white"></a>
#+html: <a href="https://tailwindcss.com"><img src="https://img.shields.io/badge/Tailwind_CSS-4-06B6D4?logo=tailwindcss&logoColor=white"></a>
#+html: <a href="https://www.typescriptlang.org"><img src="https://img.shields.io/badge/TypeScript-strict-3178C6?logo=typescript&logoColor=white"></a>
#+html: <a href="https://v2.tauri.app"><img src="https://img.shields.io/badge/Tauri-2-FFC131?logo=tauri&logoColor=white"></a>

A manga/comic reader that runs entirely in the browser. Upload a ZIP/CBZ and start reading — all parsing, decompression, and image extraction happen client-side using the Web Compression API. No server, no uploads, nothing leaves your machine. Also ships as a native desktop/mobile app via Tauri and a self-hosted local server for LAN access.

* Features

- *Two reading modes* — vertical scroll with IntersectionObserver page tracking, or page-turn with left/right click zones and image preloading
- *RTL support* — right-to-left reading with reversed navigation
- *Double-page spreads* — automatic wide-page detection for proper layout
- *Hold-to-zoom* — press =z= in page-turn mode to zoom to cursor position
- *Progress saving* — chapter and page position persisted to localStorage, auto-resumes on return
- *Offline downloads* — download manga or individual chapters to IndexedDB for offline reading
- *Customizable keybindings* — rebind every shortcut from the Settings page
- *Plugin system* — extensible viewer and plugin architecture with a runner/registry pattern
- *Desktop & mobile app* — native Tauri 2 app (Rust shell) that reads from a local directory with file dialog support
- *Self-hosted server* — adapter-node build that serves manga from a directory to any device on your network
- *Zero dependencies for ZIP* — custom ZIP/CBZ parser (with ZIP64 support) built on the Web Compression API, no libraries

* Architecture

#+begin_src
src/
├── lib/
│   ├── viewers/             # Reading mode implementations
│   │   ├── PageScrollViewer.svelte  # Virtual-scrolled vertical reader
│   │   ├── PageTurnViewer.svelte    # Single/double page with preloading
│   │   ├── registry.ts             # Viewer plugin registry
│   │   └── builtin.ts              # Built-in viewer registration
│   ├── actions/             # Svelte actions (edge swipe detection)
│   ├── commands/            # Keybinding command definitions
│   ├── plugins/             # Plugin system (runner, types, window title)
│   ├── server/              # Local server: directory listing + Node ZIP parsing
│   ├── sources/             # Data source abstraction (file upload, server, Tauri)
│   ├── pipeline/            # Image loading pipeline
│   ├── zip.ts               # Browser ZIP/CBZ parser (ZIP64, Web Compression API)
│   ├── zip-parse.ts         # Low-level ZIP binary parsing
│   ├── chapters.ts          # Auto chapter detection from directory structure
│   ├── download.svelte.ts   # IndexedDB offline storage
│   └── keybindings.svelte.ts # Configurable keyboard shortcuts
├── routes/
│   ├── +page.svelte         # Main reader view
│   ├── settings/            # Settings page
│   └── about/               # About page
└── src-tauri/               # Tauri native shell (Rust)
#+end_src

State management uses a single Svelte 5 =$state= rune object — no stores, no context API. One reactive module owns all ZIP parsing, chapter grouping, image extraction, and progress persistence.

* Tech Stack

| Layer       | Technology                                     |
|-------------+------------------------------------------------|
| Framework   | Svelte 5 (runes), SvelteKit 2                  |
| Language    | TypeScript 5.9 (strict)                         |
| Styling     | Tailwind CSS 4, Source Code Pro monospace font   |
| Desktop     | Tauri 2 (Rust)                                  |
| ZIP Parsing | Custom implementation — Web Compression API      |
| Icons       | Lucide Svelte                                   |
| Quality     | ESLint 9, Prettier, Vitest, svelte-check         |

* Quick Start

** Online (no install)

Visit the deployed site and drop a ZIP or CBZ file.

** Local Server (one-click)

Download and run the starter script — it handles Node.js installation, building, and serving:

*** Linux / macOS

#+begin_src sh
curl -fSL https://github.com/NasreddinHodja/konigslibrary/raw/main/static/download/konigslibrary.sh -o konigslibrary.sh
chmod +x konigslibrary.sh
./konigslibrary.sh
#+end_src

*** Windows

Download =konigslibrary.bat= from the repo's =static/download/= directory and double-click it.

*** What happens

1. Downloads Node.js 22 (if not already installed)
2. Downloads the source, installs dependencies, builds with =adapter-node=
3. Starts the server on =http://localhost:3000=
4. Auto-opens your browser

The server prints LAN addresses so other devices on your network can connect.

** Local Server (manual)

If you already have Node.js >= 22 and pnpm:

#+begin_src sh
pnpm install
pnpm build:local
pnpm serve
#+end_src

Set =MANGA_DIR= to point at your manga directory:

#+begin_src sh
MANGA_DIR=~/Manga pnpm serve
#+end_src

Or configure it through the Settings panel in the web UI — saved to =konigslibrary.json=.

** Desktop App (Tauri)

#+begin_src sh
pnpm tauri:local          # dev mode
pnpm tauri build          # release build
#+end_src

The desktop app reads manga directly from a local folder. Use the settings gear to pick your manga directory (or use the file dialog).

** Android

A signed APK is available at =static/download/konigslibrary.apk=.

** Environment Variables

| Variable      | Default       | Description                      |
|---------------+---------------+----------------------------------|
| =MANGA_DIR=  | (from config) | Path to your manga directory     |
| =PORT=       | =3000=        | Server port                      |
| =HOST=       | =0.0.0.0=     | Bind address                     |
| =LOCAL_BUILD= | (unset)      | Set to =1= for local server build |

* Development

*Prerequisites:* Node.js 22+ (see =.nvmrc=), pnpm

#+begin_src sh
pnpm install
pnpm dev
#+end_src

| Command              | Description                          |
|----------------------+--------------------------------------|
| =pnpm dev=           | Start dev server                     |
| =pnpm build=         | Production build (adapter-auto)      |
| =pnpm build:local=   | Local server build (adapter-node)    |
| =pnpm serve=         | Start local server                   |
| =pnpm check=         | Svelte type checking                 |
| =pnpm lint=          | Prettier + ESLint check              |
| =pnpm format=        | Auto-format with Prettier            |
| =pnpm test=          | Run tests (Vitest)                   |
| =pnpm tauri:local=   | Tauri dev mode                       |
| =pnpm tauri build=   | Tauri release build                  |

* Keyboard Shortcuts

All shortcuts are rebindable from Settings. Defaults:

| Key              | Action                                |
|------------------+---------------------------------------|
| =j= / =↓=       | Next page                             |
| =k= / =↑=       | Previous page                         |
| =l= / =→=       | Next page (prev in RTL)               |
| =h= / =←=       | Previous page (next in RTL)           |
| =n= / =]=       | Next chapter                          |
| =p= / =[=       | Previous chapter                      |
| =z= (hold)      | Zoom to cursor (page-turn mode)       |
| =s=              | Toggle sidebar                        |
| =b=              | Back to library                       |
| =m=              | Toggle scroll / page-turn mode        |
| =r=              | Toggle LTR / RTL                      |
| =d=              | Toggle single / double page           |
| =-= / ===       | Zoom out / in (scroll mode)           |
| =?=              | Show keyboard shortcuts help          |
| =Escape=         | Close sidebar or help dialog          |

Click left/right halves of the page-turn viewer to navigate.
